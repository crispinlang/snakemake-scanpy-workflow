# Snakemake + Scanpy Workflow for PBMC 3k Analysis  
*A reproducible single-cell RNA-seq preprocessing and analysis pipeline*

This repository contains a fully modular and reproducible **Snakemake workflow** for preprocessing and analyzing the **PBMC 3k** single-cell RNA-seq dataset using **Scanpy**.  
It was developed as part of a coursework assignment and demonstrates:

- Workflow automation via **Snakemake**  
- Environment reproducibility via **Conda**  
- Modular pipeline design (scripts, config, Snakefile)  
- Single-cell QC, preprocessing, and dimensionality reduction  
- Clustering (Leiden) and visualization (UMAP)  
- Clean project layout following community best practices  

The pipeline is ready to run on any system with **Miniforge/Mambaforge + Snakemake** installed.

---

# ğŸ“ Project Structure

snakemake_project/
â”œâ”€â”€ Snakefile                   # Core Snakemake workflow
â”œâ”€â”€ config.yaml                 # User-defined parameters and sample list
â”œâ”€â”€ envs/
â”‚   â””â”€â”€ scanpy.yaml             # Conda environment for Scanpy + dependencies
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ preprocess.py           # QC, filtering, normalization
â”‚   â””â”€â”€ analysis.py             # PCA, neighbors, Leiden, UMAP, outputs
â”œâ”€â”€ data/                       # (User-supplied) raw dataset goes here
â”œâ”€â”€ results/                    # Output generated by Snakemake
â””â”€â”€ README.md                   # This file

---

# âš ï¸ Data Not Included (Important)

The original 10x Genomics **PBMC 3k** dataset is **not included** due to size restrictions and good repository practices.

To run the workflow, your professor must download the data manually:

### Download PBMC 3k (filtered 10x matrix):
https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz

Extract it and place the files into:
- data/pbmc3k/

The directory **must** contain:
- barcodes.tsv
- genes.tsv
- matrix.mtx

---

# ğŸ§¬ Pipeline Overview

The workflow includes two main rules:

### 1. `preprocess`  
- Reads 10x Genomics matrix  
- Filters cells by minimum gene count  
- Removes high mitochondrial content  
- Normalizes and log-transforms counts  
- Saves `preprocessed.h5ad`

### 2. `analyze`  
- Identifies highly variable genes  
- Scales data  
- Runs PCA  
- Computes neighbor graph  
- Performs Leiden clustering  
- Computes UMAP  
- Saves:
  - `results.h5ad`
  - `umap.png` (colored by Leiden clusters)

The parameters (e.g., QC thresholds) are set in `config.yaml`.

---

# ğŸ› ï¸ Requirements

Your system must have:

### âœ” Miniforge / Mambaforge (recommended)
Install via Homebrew (macOS):

```bash
brew install miniforge

---

# How to run the pipeline:

1. Clone the Repository
- git clone https://github.com/<your-username>/snakemake-scanpy-workflow.git
- cd snakemake-scanpy-workflow

2. Install Snakemake Environment
- mamba create -n snakemake -c conda-forge -c bioconda snakemake
- conda activate snakemake

3. Download PBMC 3k Data
- https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz

Extract and place here:
- data/pbmc3k/

4. Run the Workflow
- snakemake --cores 4 --use-conda

5. Create DAG
- snakemake --dag | dot -Tpng > dag.png
